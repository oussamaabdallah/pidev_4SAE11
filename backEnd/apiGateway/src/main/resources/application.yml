# ========== Gateway routes (dynamic: targets resolved via Eureka) ==========
# Each route: /<prefix>/** -> lb://<service-id> with first path segment stripped.
# Service instances are resolved at runtime from Eureka. Add a new route block
# for any new microservice (same pattern: id, uri lb://<eureka-service-id>, Path, StripPrefix=1).
spring:
  # Allow large JSON bodies (e.g. Base64 signature images) through the reactive gateway
  codec:
    max-in-memory-size: 10MB
  cloud:
    gateway:
      globalcors:
        add-to-simple-url-handler-mapping: true
        cors-configurations:
          '[/**]':
            allowedOrigins:
              - "http://localhost:4200"
              - "http://127.0.0.1:4200"
            allowedMethods:
              - GET
              - POST
              - PUT
              - DELETE
              - OPTIONS
              - PATCH
            allowedHeaders:
              - Authorization
              - Content-Type
              - Accept
              - Origin
              - X-Requested-With
            allowCredentials: true
      discovery:
        locator:
          enabled: false
          lower-case-service-id: true
      routes:
        - id: keycloak-auth
          uri: http://localhost:8079
          predicates:
            - Path=/keycloak-auth/**
          filters:
            - StripPrefix=1

        - id: user
          uri: http://localhost:8090
          predicates:
            - Path=/user/**
          filters:
            - StripPrefix=1

        - id: portfolio
          uri: lb://PORTFOLIO
          predicates:
            - Path=/portfolio/**
          filters:
            - StripPrefix=1
          metadata:
            response-timeout: 120000
            connect-timeout: 10000


        # Planning: direct URL (no Eureka), same as project
        - id: planning
          uri: http://localhost:8081
          predicates:
            - Path=/planning/**
          filters:
            - StripPrefix=1

        # Review: direct URL so it works without Eureka (service runs on 8085)
        - id: review
          uri: http://localhost:8085
          predicates:
            - Path=/review/**
          filters:
            - StripPrefix=1

        # Project: direct URL so requests always hit the Project microservice (port 8084)
        - id: project
          uri: http://localhost:8084
          predicates:
            - Path=/project/**
          filters:
            - StripPrefix=1

        - id: offer
          uri: lb://OFFER
          predicates:
            - Path=/offer/**
          filters:
            - StripPrefix=1

        - id: contract
          uri: http://localhost:8083
          predicates:
            - Path=/contract/**
          filters:
            - StripPrefix=1
