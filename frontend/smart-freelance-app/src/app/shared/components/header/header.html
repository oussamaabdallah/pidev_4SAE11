<header class="header" [class.scrolled]="isScrolled()">
  <div class="header-container">

    <!-- ── Logo ── -->
    <a [routerLink]="logoRoute" class="header-logo" aria-label="Freelancia home">
      <svg class="logo-mark" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <defs>
          <linearGradient id="lg" x1="0" y1="0" x2="28" y2="28" gradientUnits="userSpaceOnUse">
            <stop offset="0%" stop-color="#E37E33"/>
            <stop offset="100%" stop-color="#E23D59"/>
          </linearGradient>
        </defs>
        <!-- Stylised "F" spark / lightning bolt -->
        <path d="M7 4h13l-6 9h8L8 24l4-11H6L7 4z" fill="url(#lg)" />
      </svg>
      <span class="logo-text">Freelancia</span>
    </a>

    <!-- ── Dashboard: Grouped navigation (desktop) ── -->
    @if (variant === 'dashboard' && auth.isLoggedIn()) {
      <nav class="main-nav" aria-label="Main navigation">

        <!-- ── FREELANCER nav ── -->
        @if (auth.isFreelancer()) {

          <!-- My Work dropdown -->
          <div class="nav-group" role="none">
            <button class="nav-trigger"
                    [class.open]="activeDropdown() === 'work'"
                    aria-haspopup="true"
                    [attr.aria-expanded]="activeDropdown() === 'work'"
                    (click)="toggleDropdown('work')">
              My Work
              <svg class="chevron" viewBox="0 0 16 16" fill="none" aria-hidden="true">
                <path d="M4 6l4 4 4-4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
            @if (activeDropdown() === 'work') {
              <div class="nav-dropdown" role="menu" aria-label="My Work menu">
                <a routerLink="/dashboard/my-offers" class="dropdown-link" role="menuitem" (click)="closeDropdown()">
                  <svg viewBox="0 0 20 20" fill="none" aria-hidden="true"><path d="M6 4h8a2 2 0 012 2v10a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2zM8 4V2m4 2V2" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/></svg>
                  My Offers
                </a>
                <a routerLink="/dashboard/browse-jobs" class="dropdown-link" role="menuitem" (click)="closeDropdown()">
                  <svg viewBox="0 0 20 20" fill="none" aria-hidden="true"><circle cx="9" cy="9" r="5" stroke="currentColor" stroke-width="1.4"/><path d="M16 16l-3-3" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/></svg>
                  Browse Jobs
                </a>
                <a routerLink="/dashboard/my-applications" class="dropdown-link" role="menuitem" (click)="closeDropdown()">
                  <svg viewBox="0 0 20 20" fill="none" aria-hidden="true"><path d="M4 4h12a1 1 0 011 1v10a1 1 0 01-1 1H4a1 1 0 01-1-1V5a1 1 0 011-1z" stroke="currentColor" stroke-width="1.4" stroke-linejoin="round"/><path d="M7 8h6M7 11h4" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/></svg>
                  My Applications
                </a>
                <a routerLink="/dashboard/my-contracts" class="dropdown-link" role="menuitem" (click)="closeDropdown()">
                  <svg viewBox="0 0 20 20" fill="none" aria-hidden="true"><path d="M6 2h8l4 4v12a1 1 0 01-1 1H3a1 1 0 01-1-1V3a1 1 0 011-1h3z" stroke="currentColor" stroke-width="1.4" stroke-linejoin="round"/><path d="M7 9h6M7 12h4" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/></svg>
                  My Contracts
                </a>
              </div>
            }
          </div>

          <!-- Growth dropdown -->
          <div class="nav-group" role="none">
            <button class="nav-trigger"
                    [class.open]="activeDropdown() === 'growth'"
                    aria-haspopup="true"
                    [attr.aria-expanded]="activeDropdown() === 'growth'"
                    (click)="toggleDropdown('growth')">
              Growth
              <svg class="chevron" viewBox="0 0 16 16" fill="none" aria-hidden="true">
                <path d="M4 6l4 4 4-4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
            @if (activeDropdown() === 'growth') {
              <div class="nav-dropdown" role="menu" aria-label="Growth menu">
                <a routerLink="/dashboard/progress-updates" class="dropdown-link" role="menuitem" (click)="closeDropdown()">
                  <svg viewBox="0 0 20 20" fill="none" aria-hidden="true"><path d="M4 14l4-4 3 3 5-7" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/></svg>
                  My Progress
                </a>
                <a routerLink="/dashboard/my-portfolio" class="dropdown-link" role="menuitem" (click)="closeDropdown()">
                  <svg viewBox="0 0 20 20" fill="none" aria-hidden="true"><rect x="2" y="5" width="16" height="12" rx="1" stroke="currentColor" stroke-width="1.4" stroke-linejoin="round"/><path d="M2 8h16" stroke="currentColor" stroke-width="1.4"/><circle cx="7" cy="12" r="2" stroke="currentColor" stroke-width="1.3"/></svg>
                  My Portfolio
                </a>
              </div>
            }
          </div>

        }

        <!-- ── CLIENT nav ── -->
        @if (auth.isClient()) {

          <!-- Find Talent dropdown -->
          <div class="nav-group" role="none">
            <button class="nav-trigger"
                    [class.open]="activeDropdown() === 'talent'"
                    aria-haspopup="true"
                    [attr.aria-expanded]="activeDropdown() === 'talent'"
                    (click)="toggleDropdown('talent')">
              Find Talent
              <svg class="chevron" viewBox="0 0 16 16" fill="none" aria-hidden="true">
                <path d="M4 6l4 4 4-4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
            @if (activeDropdown() === 'talent') {
              <div class="nav-dropdown" role="menu" aria-label="Find Talent menu">
                <a routerLink="/dashboard/browse-freelancers" class="dropdown-link" role="menuitem" (click)="closeDropdown()">
                  <svg viewBox="0 0 20 20" fill="none" aria-hidden="true"><circle cx="8" cy="7" r="4" stroke="currentColor" stroke-width="1.4"/><path d="M2 17c0-3 2.7-5 6-5m4 0l3 3 3-3" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/></svg>
                  Browse Freelancers
                </a>
                <a routerLink="/dashboard/browse-offers" class="dropdown-link" role="menuitem" (click)="closeDropdown()">
                  <svg viewBox="0 0 20 20" fill="none" aria-hidden="true"><path d="M6 4h8a2 2 0 012 2v10a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2z" stroke="currentColor" stroke-width="1.4" stroke-linejoin="round"/><path d="M7 9h6M7 12h4" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/></svg>
                  Browse Offers
                </a>
              </div>
            }
          </div>

          <!-- Manage dropdown -->
          <div class="nav-group" role="none">
            <button class="nav-trigger"
                    [class.open]="activeDropdown() === 'manage'"
                    aria-haspopup="true"
                    [attr.aria-expanded]="activeDropdown() === 'manage'"
                    (click)="toggleDropdown('manage')">
              Manage
              <svg class="chevron" viewBox="0 0 16 16" fill="none" aria-hidden="true">
                <path d="M4 6l4 4 4-4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
            @if (activeDropdown() === 'manage') {
              <div class="nav-dropdown" role="menu" aria-label="Manage menu">
                <a routerLink="/dashboard/my-projects" class="dropdown-link" role="menuitem" (click)="closeDropdown()">
                  <svg viewBox="0 0 20 20" fill="none" aria-hidden="true"><path d="M3 7h14a1 1 0 011 1v8a1 1 0 01-1 1H3a1 1 0 01-1-1V8a1 1 0 011-1z" stroke="currentColor" stroke-width="1.4" stroke-linejoin="round"/><path d="M1 7l3-4h12l3 4" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/></svg>
                  My Projects
                </a>
                <a routerLink="/dashboard/my-contracts" class="dropdown-link" role="menuitem" (click)="closeDropdown()">
                  <svg viewBox="0 0 20 20" fill="none" aria-hidden="true"><path d="M6 2h8l4 4v12a1 1 0 01-1 1H3a1 1 0 01-1-1V3a1 1 0 011-1z" stroke="currentColor" stroke-width="1.4" stroke-linejoin="round"/><path d="M7 9h6M7 12h4" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/></svg>
                  My Contracts
                </a>
                <a routerLink="/dashboard/my-offer-applications" class="dropdown-link" role="menuitem" (click)="closeDropdown()">
                  <svg viewBox="0 0 20 20" fill="none" aria-hidden="true"><path d="M4 4h12a1 1 0 011 1v10a1 1 0 01-1 1H4a1 1 0 01-1-1V5a1 1 0 011-1z" stroke="currentColor" stroke-width="1.4" stroke-linejoin="round"/><path d="M7 8h6M7 11h4" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/></svg>
                  My Applications
                </a>
                <a routerLink="/dashboard/track-progress" class="dropdown-link" role="menuitem" (click)="closeDropdown()">
                  <svg viewBox="0 0 20 20" fill="none" aria-hidden="true"><path d="M4 14l4-4 3 3 5-7" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/></svg>
                  Track Progress
                </a>
              </div>
            }
          </div>

        }

        <!-- Reviews: direct link (both roles) -->
        <a routerLink="/dashboard/reviews" class="nav-direct" routerLinkActive="active">Reviews</a>

      </nav>
    }

    <!-- ── Dashboard: Search bar (desktop + tablet) ── -->
    @if (variant === 'dashboard' && auth.isLoggedIn()) {
      <form class="search-form" (submit)="handleSearch($event, searchInput.value)" role="search">
        <div class="search-wrapper">
          <svg class="search-icon-left" viewBox="0 0 20 20" fill="none" aria-hidden="true">
            <circle cx="9" cy="9" r="5" stroke="currentColor" stroke-width="1.5"/>
            <path d="M15 15l-3-3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
          <input
            #searchInput
            type="search"
            class="search-input"
            [placeholder]="auth.isFreelancer() ? 'Search jobs, freelancers…' : 'Search freelancers, offers…'"
            aria-label="Search" />
          <button type="submit" class="search-submit-btn" aria-label="Submit search">
            Search
          </button>
        </div>
      </form>
    }

    <!-- ── Public: Center nav links ── -->
    @if (variant === 'public') {
      <nav class="header-nav" [class.open]="mobileMenuOpen()">
        <a routerLink="/how-it-works" class="nav-link" routerLinkActive="active">How It Works</a>
        <a routerLink="/about" class="nav-link" routerLinkActive="active">About</a>
      </nav>
    }

    <!-- ── Right: Actions ── -->
    <div class="header-actions">

      @if (!auth.isLoggedIn()) {
        <!-- Not logged in: Login / Sign Up -->
        <a routerLink="/login">
          <app-button variant="ghost" size="sm">Login</app-button>
        </a>
        <a routerLink="/signup">
          <app-button variant="primary" size="sm">Sign Up</app-button>
        </a>

      } @else {

        @if (variant === 'dashboard') {
          <!-- Messages -->
          <a routerLink="/dashboard/messages" class="icon-btn" aria-label="Messages">
            <svg viewBox="0 0 20 20" fill="none" aria-hidden="true">
              <path d="M3 4h14a1 1 0 011 1v8a1 1 0 01-1 1H5l-3 3V5a1 1 0 011-1z" stroke="currentColor" stroke-width="1.4" stroke-linejoin="round"/>
            </svg>
          </a>

          <!-- Notifications -->
          <a routerLink="/dashboard/notifications" class="icon-btn notif-btn" aria-label="Notifications">
            <svg viewBox="0 0 20 20" fill="none" aria-hidden="true">
              <path d="M10 2a6 6 0 00-6 6c0 5-2 6-2 6h16s-2-1-2-6a6 6 0 00-6-6z" stroke="currentColor" stroke-width="1.4" stroke-linejoin="round"/>
              <path d="M11.73 17a2 2 0 01-3.46 0" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/>
            </svg>
          </a>

          <!-- Primary CTA -->
          @if (auth.isFreelancer()) {
            <a routerLink="/dashboard/my-offers" class="cta-btn desktop-cta" aria-label="Create a new offer">
              <svg viewBox="0 0 16 16" fill="none" aria-hidden="true">
                <path d="M8 3v10M3 8h10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
              Create Offer
            </a>
          }
          @if (auth.isClient()) {
            <a routerLink="/dashboard/post-job" class="cta-btn desktop-cta" aria-label="Post a job">
              <svg viewBox="0 0 16 16" fill="none" aria-hidden="true">
                <path d="M8 3v10M3 8h10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
              Post a Job
            </a>
          }
        }

        <!-- User dropdown (all variants) -->
        <div class="user-menu-container">
          <button class="user-menu-trigger"
                  (click)="toggleUserMenu()"
                  aria-haspopup="true"
                  [attr.aria-expanded]="userMenuOpen()">
            @if (avatarUrl()) {
              <img [src]="avatarUrl()" alt="" class="user-avatar-img" (error)="onAvatarError()" />
            } @else {
              <span class="user-avatar">{{ auth.getUserRole()?.[0] || 'U' }}</span>
            }
            <span class="user-name">{{ auth.getDisplayName() }}</span>
            <svg class="chevron-user" viewBox="0 0 16 16" fill="none" aria-hidden="true"
                 [class.rotated]="userMenuOpen()">
              <path d="M4 6l4 4 4-4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>

          @if (userMenuOpen()) {
            <div class="user-menu-dropdown" role="menu">
              @if (auth.isAdmin()) {
                <a routerLink="/admin" class="dropdown-item" role="menuitem" (click)="userMenuOpen.set(false)">Admin Dashboard</a>
              } @else {
                <a routerLink="/dashboard" class="dropdown-item" role="menuitem" (click)="userMenuOpen.set(false)">Dashboard</a>
              }
              <a routerLink="/dashboard/profile" class="dropdown-item" role="menuitem" (click)="userMenuOpen.set(false)">Profile</a>
              <a routerLink="/dashboard/settings" class="dropdown-item" role="menuitem" (click)="userMenuOpen.set(false)">Settings</a>
              <div class="dropdown-divider" role="separator"></div>
              <button class="dropdown-item logout" role="menuitem" (click)="logout()">Log out</button>
            </div>
          }
        </div>

      }

      <!-- Public header: mobile toggle -->
      @if (variant === 'public') {
        <button class="mobile-menu-toggle" (click)="toggleMobileMenu()" aria-label="Toggle navigation menu">
          <svg viewBox="0 0 20 20" fill="none" stroke="currentColor" aria-hidden="true">
            <path d="M3 10h14M3 5h14M3 15h14" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
        </button>
      }

      <!-- Dashboard: hamburger (tablet + mobile) -->
      @if (variant === 'dashboard' && auth.isLoggedIn()) {
        <button class="mobile-hamburger"
                (click)="toggleDashboardMobile()"
                [class.open]="dashboardMobileOpen()"
                aria-label="Toggle navigation menu"
                [attr.aria-expanded]="dashboardMobileOpen()">
          @if (!dashboardMobileOpen()) {
            <svg viewBox="0 0 20 20" fill="none" aria-hidden="true">
              <path d="M3 10h14M3 5h14M3 15h14" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
            </svg>
          } @else {
            <svg viewBox="0 0 20 20" fill="none" aria-hidden="true">
              <path d="M5 5l10 10M15 5L5 15" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
            </svg>
          }
        </button>
      }

    </div>
  </div>

  <!-- ── Mobile drawer (dashboard only) ── -->
  @if (variant === 'dashboard' && auth.isLoggedIn()) {
    <div class="mobile-drawer" [class.open]="dashboardMobileOpen()" aria-label="Mobile navigation">

      <!-- Mobile search -->
      <form class="mobile-search-form"
            (submit)="handleSearch($event, mobileSearchInput.value); dashboardMobileOpen.set(false)"
            role="search">
        <div class="search-wrapper">
          <svg class="search-icon-left" viewBox="0 0 20 20" fill="none" aria-hidden="true">
            <circle cx="9" cy="9" r="5" stroke="currentColor" stroke-width="1.5"/>
            <path d="M15 15l-3-3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
          <input
            #mobileSearchInput
            type="search"
            class="search-input"
            [placeholder]="auth.isFreelancer() ? 'Search jobs, freelancers…' : 'Search freelancers, offers…'"
            aria-label="Search" />
        </div>
      </form>

      <!-- Mobile nav sections -->
      <div class="mobile-nav-body">

        @if (auth.isFreelancer()) {
          <div class="mobile-section">
            <span class="mobile-section-label">My Work</span>
            <a routerLink="/dashboard/my-offers"       routerLinkActive="active" class="mobile-nav-item" (click)="dashboardMobileOpen.set(false)">My Offers</a>
            <a routerLink="/dashboard/browse-jobs"      routerLinkActive="active" class="mobile-nav-item" (click)="dashboardMobileOpen.set(false)">Browse Jobs</a>
            <a routerLink="/dashboard/my-applications"  routerLinkActive="active" class="mobile-nav-item" (click)="dashboardMobileOpen.set(false)">My Applications</a>
            <a routerLink="/dashboard/my-contracts"     routerLinkActive="active" class="mobile-nav-item" (click)="dashboardMobileOpen.set(false)">My Contracts</a>
          </div>
          <div class="mobile-section">
            <span class="mobile-section-label">Growth</span>
            <a routerLink="/dashboard/progress-updates" routerLinkActive="active" class="mobile-nav-item" (click)="dashboardMobileOpen.set(false)">My Progress</a>
            <a routerLink="/dashboard/my-portfolio"     routerLinkActive="active" class="mobile-nav-item" (click)="dashboardMobileOpen.set(false)">My Portfolio</a>
          </div>
        }

        @if (auth.isClient()) {
          <div class="mobile-section">
            <span class="mobile-section-label">Find Talent</span>
            <a routerLink="/dashboard/browse-freelancers"   routerLinkActive="active" class="mobile-nav-item" (click)="dashboardMobileOpen.set(false)">Browse Freelancers</a>
            <a routerLink="/dashboard/browse-offers"        routerLinkActive="active" class="mobile-nav-item" (click)="dashboardMobileOpen.set(false)">Browse Offers</a>
          </div>
          <div class="mobile-section">
            <span class="mobile-section-label">Manage</span>
            <a routerLink="/dashboard/my-projects"          routerLinkActive="active" class="mobile-nav-item" (click)="dashboardMobileOpen.set(false)">My Projects</a>
            <a routerLink="/dashboard/my-contracts"         routerLinkActive="active" class="mobile-nav-item" (click)="dashboardMobileOpen.set(false)">My Contracts</a>
            <a routerLink="/dashboard/my-offer-applications" routerLinkActive="active" class="mobile-nav-item" (click)="dashboardMobileOpen.set(false)">My Applications</a>
            <a routerLink="/dashboard/track-progress"       routerLinkActive="active" class="mobile-nav-item" (click)="dashboardMobileOpen.set(false)">Track Progress</a>
          </div>
        }

        <div class="mobile-section">
          <span class="mobile-section-label">Community</span>
          <a routerLink="/dashboard/reviews" routerLinkActive="active" class="mobile-nav-item" (click)="dashboardMobileOpen.set(false)">Reviews</a>
        </div>

      </div>

      <!-- Mobile CTA -->
      <div class="mobile-cta-row">
        @if (auth.isFreelancer()) {
          <a routerLink="/dashboard/my-offers" class="cta-btn mobile-cta" (click)="dashboardMobileOpen.set(false)">
            <svg viewBox="0 0 16 16" fill="none" aria-hidden="true">
              <path d="M8 3v10M3 8h10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
            Create Offer
          </a>
        }
        @if (auth.isClient()) {
          <a routerLink="/dashboard/post-job" class="cta-btn mobile-cta" (click)="dashboardMobileOpen.set(false)">
            <svg viewBox="0 0 16 16" fill="none" aria-hidden="true">
              <path d="M8 3v10M3 8h10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
            Post a Job
          </a>
        }
      </div>

    </div>
  }

</header>
