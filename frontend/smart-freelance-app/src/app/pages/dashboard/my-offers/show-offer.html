<div class="show-offer-page" *ngIf="offer">
  <div class="back-row">
    <a routerLink="/dashboard/my-offers" class="btn-back">Back to my offers</a>
  </div>
  <div class="offer-detail card">
    <div class="offer-header">
      <h1>{{ offer.title }}</h1>
      <span class="status-badge">{{ offer.offerStatus }}</span>
    </div>
    <p class="domain">{{ offer.domain }}</p>
    <p class="description">{{ offer.description }}</p>
    <div class="meta">
      <span class="price">{{ offer.price | number:'1.2-2' }} ({{ offer.durationType }})</span>
      <span *ngIf="offer.deadline">Deadline: {{ offer.deadline }}</span>
      <span *ngIf="offer.pendingApplicationsCount != null">{{ offer.pendingApplicationsCount }} pending</span>
    </div>
  </div>

  <!-- Traduction multilingue (Google Translate – FR / EN / AR) -->
  <section class="translate-section card">
    <h2 class="translate-section__title">
      <span class="translate-section__icon" aria-hidden="true"></span>
      Translate this offer
    </h2>
    <p class="translate-section__subtitle">Get title and description in another language (FR / EN / AR).</p>
    <div class="translate-section__actions">
      <button
        type="button"
        class="translate-lang-btn"
        [class.translate-lang-btn--active]="selectedTranslateLang === 'fr'"
        (click)="selectedTranslateLang = 'fr'"
      >
        Français
      </button>
      <button
        type="button"
        class="translate-lang-btn"
        [class.translate-lang-btn--active]="selectedTranslateLang === 'en'"
        (click)="selectedTranslateLang = 'en'"
      >
        English
      </button>
      <button
        type="button"
        class="translate-lang-btn"
        [class.translate-lang-btn--active]="selectedTranslateLang === 'ar'"
        (click)="selectedTranslateLang = 'ar'"
      >
        العربية
      </button>
      <button
        type="button"
        class="translate-run-btn"
        (click)="runTranslate()"
        [disabled]="translating"
      >
        {{ translating ? 'Translating…' : 'Translate' }}
      </button>
    </div>
    @if (translateError) {
      <p class="translate-section__error" role="alert">{{ translateError }}</p>
    }
    @if (translatedResult) {
      <div class="translate-result" [class.translate-result--rtl]="selectedTranslateLang === 'ar'">
        <h3 class="translate-result__title">{{ translatedResult.title }}</h3>
        <p class="translate-result__description">{{ translatedResult.description }}</p>
        <p class="translate-result__meta">Translated to {{ translateLangLabel(selectedTranslateLang) }}</p>
      </div>
    }
  </section>

  <!-- Q&A : questions des clients (répondre ici) -->
  <section class="qa-freelancer-section card">
    <h2 class="qa-freelancer-section__title">Questions from clients</h2>
    <p class="qa-freelancer-section__subtitle">Answer client questions before they apply.</p>
    @if (loadingQuestions) {
      <p class="qa-freelancer-section__loading">Loading...</p>
    } @else if (offerQuestions.length === 0) {
      <p class="qa-freelancer-section__empty">No questions yet.</p>
    } @else {
      <div class="qa-freelancer-list">
        @for (q of offerQuestions; track q.id) {
          <div class="qa-freelancer-item" [class.qa-freelancer-item--answered]="q.answered">
            <p class="qa-freelancer-item__q">{{ q.questionText }}</p>
            <span class="qa-freelancer-item__date">Asked {{ formatDate(q.askedAt) }}</span>
            @if (q.answered && q.answerText) {
              <p class="qa-freelancer-item__a"><strong>Your answer:</strong> {{ q.answerText }}</p>
            } @else {
              <div class="qa-freelancer-item__answer-form">
                <textarea
                  [id]="'answer-' + q.id"
                  placeholder="Write your answer..."
                  [(ngModel)]="answerTexts[q.id]"
                  name="answer-{{ q.id }}"
                  rows="2"
                ></textarea>
                <button type="button" class="btn-answer" (click)="submitAnswer(q.id)" [disabled]="answeringId === q.id || !(answerTexts[q.id] || '').trim()">
                  {{ answeringId === q.id ? 'Sending...' : 'Reply' }}
                </button>
              </div>
            }
          </div>
        }
      </div>
    }
  </section>

  <div class="applications-section">
    <h2>Applications</h2>
    <p class="loading-msg" *ngIf="loadingApps">Loading applications...</p>
    <p class="empty-msg" *ngIf="!loadingApps && applications.length === 0">No applications yet.</p>
    <div class="applications-list" *ngIf="!loadingApps && applications.length > 0">
      <div class="app-card" *ngFor="let app of applications">
        <div class="app-main">
          <p class="app-message">{{ app.message }}</p>
          <p class="app-meta">Proposed budget: {{ app.proposedBudget | number:'1.2-2' }} - Applied {{ formatDate(app.appliedAt) }}</p>
          <span class="app-status">{{ app.status }}</span>
        </div>
        <div class="app-actions" *ngIf="app.status === 'PENDING'">
          <button type="button" class="btn-accept" (click)="accept(app)" [disabled]="actioning">Accept</button>
          <button type="button" class="btn-reject" (click)="reject(app)" [disabled]="actioning">Reject</button>
        </div>
        <div class="app-actions" *ngIf="app.status === 'ACCEPTED'">
          <button type="button" class="btn-create-project" (click)="createProject(app)">Create project</button>
        </div>
      </div>
    </div>
  </div>
</div>
<p class="error-msg" *ngIf="errorMessage">{{ errorMessage }}</p>
<p class="loading-msg" *ngIf="loading && !offer">Loading offer...</p>
